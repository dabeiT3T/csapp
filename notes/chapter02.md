## Chapter 2

### 2.3 整数运算

#### 2.3.7 除以 2 的幂

> 在大多数机器上，整数除法要比整数乘法更慢——需要 30 个或者更多的时钟周期。
>
> 无符号和补码数分别使用逻辑位移和算数位移来达到目的。
>
> 对于 x >= 0 和 y > 0，结果会是 ⌊x/y⌋，而对于 x < 0 和 y > 0，结果会是 ⌈x/y⌉。也就是说，它将向下舍入一个正值，而向上舍入一个负值。

实际上 C 语言除法不管符号，结果直接抹去小数；**但是右移操作在负数时，并不符合 C 常规的除法，它将向下舍入。**

> 我们可以通过在位移之前”偏置（biasing）“这个值，来修正这种不合适的舍入。
>
> C 变量 x 和 k 分别有补码值 x 和无符号值 k，且 0 <= k < w，则当执行算数位移时，C 表达式 (x+(1<<k)-1)>>k 产生数值 ⌊x/(2^k)⌋。
>
> 偏置技术利用如下属性：对于整数 x 和 y (y > 0)，⌈x/y⌉ = ⌊(x+y-1)/y⌋。

该技术把向上舍入转化成了向下舍入，使得负数可以通过右移虽然向下舍入但是结果满足常规除法；

